<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Security Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        /* Custom scrollbar for better aesthetics */
        textarea::-webkit-scrollbar { width: 8px; }
        textarea::-webkit-scrollbar-thumb { background-color: #9ca3af; border-radius: 4px; }
        textarea::-webkit-scrollbar-track { background-color: #e5e7eb; }
    </style>
</head>
<body class="min-h-screen p-4 sm:p-8 flex items-start justify-center">

    <!-- Main Application Container -->
    <div id="app" class="w-full max-w-4xl bg-white shadow-2xl rounded-xl overflow-hidden transform transition duration-500 ease-in-out">

        <!-- Header -->
        <header class="p-6 border-b border-gray-100 bg-indigo-600 text-white">
            <h1 class="text-3xl font-bold tracking-tight">ðŸ”’ Security Hub Pro</h1>
            <p class="text-indigo-200 mt-1 text-sm">Cipher Tools and AI-Assisted Password Generation</p>
        </header>

        <!-- Tabs Navigation -->
        <nav class="flex border-b border-gray-200">
            <button id="tab-crypto" onclick="showTab('crypto')" class="tab-button flex-1 py-3 px-4 text-center font-medium text-lg border-b-2 transition duration-150 ease-in-out" data-tab="crypto">
                Encryption & Decryption
            </button>
            <button id="tab-password" onclick="showTab('password')" class="tab-button flex-1 py-3 px-4 text-center font-medium text-lg border-b-2 transition duration-150 ease-in-out" data-tab="password">
                Password Generator (Gemini AI)
            </button>
        </nav>

        <!-- Content Area -->
        <main class="p-6 sm:p-8">

            <!-- Tab 1: Encryption & Decryption -->
            <section id="crypto-tab" class="tab-content space-y-6 hidden">
                <h2 class="text-2xl font-semibold text-gray-800 border-b pb-2 mb-4">Encryption & Decryption</h2>
                
                <!-- Input/Output Textareas -->
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label for="crypto-input" class="block text-sm font-medium text-gray-700 mb-2">Input Text</label>
                        <textarea id="crypto-input" rows="8" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150" placeholder="Enter text to encrypt/decrypt..."></textarea>
                    </div>
                    <div>
                        <label for="crypto-output" class="block text-sm font-medium text-gray-700 mb-2">Output Text</label>
                        <textarea id="crypto-output" rows="8" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 resize-none transition duration-150" readonly placeholder="Result will appear here..."></textarea>
                    </div>
                </div>

                <!-- Cipher Selection and Controls -->
                <div class="bg-gray-50 p-4 rounded-lg shadow-inner">
                    <div class="flex flex-wrap gap-4 items-center mb-4">
                        <label class="text-sm font-medium text-gray-700">Select Cipher:</label>
                        
                        <div class="flex items-center space-x-4">
                            <label><input type="radio" name="cipher" value="rot" checked onchange="updateCipherControls()" class="mr-1 accent-indigo-600"> ROT-N</label>
                            <label><input type="radio" name="cipher" value="base64" onchange="updateCipherControls()" class="mr-1 accent-indigo-600"> Base64</label>
                            <label><input type="radio" name="cipher" value="vigenere" onchange="updateCipherControls()" class="mr-1 accent-indigo-600"> VigenÃ¨re Cipher</label>
                        </div>
                    </div>
                    
                    <div id="rot-control" class="flex items-center space-x-3 mb-4">
                        <label for="rot-shift" class="text-sm font-medium text-gray-700">ROT Shift (1-25):</label>
                        <input type="number" id="rot-shift" value="13" min="1" max="25" class="w-20 p-2 border border-gray-300 rounded-lg text-center focus:ring-indigo-500 focus:border-indigo-500">
                    </div>

                    <!-- NEW: VigenÃ¨re Control Section to accept a keyword -->
                    <div id="vigenere-control" class="hidden bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-3 rounded-md mb-4 space-y-2" role="alert">
                        <p class="font-bold">VigenÃ¨re Cipher Keyword:</p>
                        <div class="space-y-2">
                            <label for="vigenere-key-input" class="text-sm font-medium text-yellow-800">Your Cipher Keyword (e.g., 'SECRET'):</label>
                            <input type="text" id="vigenere-key-input" class="w-full p-2 border border-yellow-300 rounded-lg text-sm focus:ring-yellow-500 focus:border-yellow-500 uppercase" placeholder="Enter keyword (letters only)">
                        </div>
                        <p class="text-xs text-yellow-600">The VigenÃ¨re cipher uses a repeating keyword to shift letters. Only alphabetic characters are used for the key.</p>
                    </div>

                    <!-- Actions -->
                    <div class="flex space-x-4">
                        <button onclick="performCrypto('encrypt')" class="flex-1 px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition duration-150 ease-in-out">
                            Encrypt
                        </button>
                        <button onclick="performCrypto('decrypt')" class="flex-1 px-6 py-3 bg-gray-200 text-gray-800 font-semibold rounded-lg shadow-md hover:bg-gray-300 transition duration-150 ease-in-out">
                            Decrypt
                        </button>
                    </div>
                </div>
            </section>

            <!-- Tab 2: Password Generator -->
            <section id="password-tab" class="tab-content space-y-6 hidden">
                <h2 class="text-2xl font-semibold text-gray-800 border-b pb-2 mb-4">AI Password Generator</h2>
                <div class="bg-blue-50 border-l-4 border-blue-500 text-blue-700 p-4 rounded-md" role="alert">
                    <p class="font-bold">How it works:</p>
                    <p class="text-sm">Enter an easy-to-remember phrase or a simple password you'd like to secure. Gemini will transform it into a highly secure, yet psychologically memorable passphrase.</p>
                </div>

                <label for="password-prompt" class="block text-sm font-medium text-gray-700 mb-2">Your Phrase/Password Idea:</label>
                <input type="text" id="password-prompt" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150" placeholder="e.g., 'ILoveMyCatBlinky' or 'MyBirthday1985'">

                <button id="generate-btn" onclick="generatePassword()" class="w-full px-6 py-3 bg-green-600 text-white font-semibold rounded-lg shadow-lg hover:bg-green-700 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed">
                    Generate Secure Password
                </button>

                <div id="password-loading" class="hidden text-center text-indigo-600 font-medium">
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-indigo-600 inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Generating highly secure passphrase...
                </div>

                <div class="mt-6">
                    <label for="password-output" class="block text-sm font-medium text-gray-700 mb-2">Generated Secure Password:</label>
                    <div class="relative">
                        <textarea id="password-output" rows="3" class="w-full p-3 border-2 border-green-500 rounded-lg bg-green-50 text-xl font-mono text-gray-800 resize-none" readonly placeholder="Your new password will appear here..."></textarea>
                        <button onclick="copyToClipboard('password-output')" class="absolute top-2 right-2 p-2 bg-green-600 text-white rounded-lg shadow hover:bg-green-700 transition duration-150">
                            Copy
                        </button>
                    </div>
                    <p id="copy-message" class="text-sm text-green-600 mt-2 hidden">Copied to clipboard!</p>
                </div>
                
                <p class="text-xs text-gray-500 mt-4 text-center">API Key is managed by the execution environment and is not visible to the user.</p>

            </section>
        </main>
    </div>

    <!-- JavaScript Logic -->
    <script>
        const API_KEY = ""; // Managed by environment
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`;
        
        let currentTab = 'crypto';
        
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize tab display
            showTab(currentTab);
        });

        function showTab(tabName) {
            currentTab = tabName;
            
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            
            // Deactivate all tab buttons
            document.querySelectorAll('.tab-button').forEach(el => {
                el.classList.remove('text-indigo-600', 'border-indigo-600');
                el.classList.add('text-gray-500', 'border-transparent', 'hover:text-gray-700', 'hover:border-gray-300');
            });

            // Show the selected tab content
            document.getElementById(`${tabName}-tab`).classList.remove('hidden');
            
            // Activate the selected tab button
            const activeBtn = document.getElementById(`tab-${tabName}`);
            activeBtn.classList.add('text-indigo-600', 'border-indigo-600');
            activeBtn.classList.remove('text-gray-500', 'border-transparent', 'hover:text-gray-700', 'hover:border-gray-300');

            // Ensure correct controls are visible for the crypto tab
            if (tabName === 'crypto') {
                updateCipherControls();
            }
        }

        // --- Tab 1: Encryption/Decryption Logic ---

        function rotCipher(text, shift, encrypt) {
            const finalShift = encrypt ? shift : (26 - (shift % 26)) % 26;

            return text.split('').map(char => {
                const charCode = char.charCodeAt(0);

                if (charCode >= 65 && charCode <= 90) { // Uppercase (A=65, Z=90)
                    return String.fromCharCode(((charCode - 65 + finalShift) % 26) + 65);
                } else if (charCode >= 97 && charCode <= 122) { // Lowercase (a=97, z=122)
                    return String.fromCharCode(((charCode - 97 + finalShift) % 26) + 97);
                }
                return char; // Non-alphabetic characters remain unchanged
            }).join('');
        }
        
        // VigenÃ¨re Cipher Implementation
        function vigenereCipher(text, keyword, mode) {
            // Clean keyword: remove non-alphabetic characters and convert to uppercase
            const key = keyword.toUpperCase().replace(/[^A-Z]/g, '');
            if (!key) return "Error: Keyword must contain at least one letter.";
            
            let result = '';
            let keyIndex = 0;

            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                let charCode = char.charCodeAt(0);
                let base = 0;
                
                // Determine the base (A=65, a=97)
                if (charCode >= 65 && charCode <= 90) { // Uppercase
                    base = 65;
                } else if (charCode >= 97 && charCode <= 122) { // Lowercase
                    base = 97;
                } else {
                    result += char; // Non-alphabetic character, ignore
                    continue;
                }

                // Calculate shift value from the current key character
                // VigenÃ¨re shift is the character position in the alphabet (A=0, B=1, ...)
                const keyShift = key.charCodeAt(keyIndex % key.length) - 65;
                let shift = keyShift;

                // Encryption or Decryption
                if (mode === 'decrypt') {
                    // For decryption, the shift is reversed (26 - keyShift)
                    shift = (26 - keyShift) % 26;
                }
                
                // Apply shift
                const originalIndex = charCode - base;
                const newIndex = (originalIndex + shift) % 26;
                
                result += String.fromCharCode(newIndex + base);

                // Advance key index only if a letter was processed
                keyIndex++;
            }

            return result;
        }

        function base64Encode(text) {
            try {
                return btoa(text);
            } catch (e) {
                return `Error: ${e.message}`;
            }
        }

        function base64Decode(text) {
            try {
                return atob(text);
            } catch (e) {
                return 'Error: Invalid Base64 string.';
            }
        }

        function updateCipherControls() {
            const selectedCipher = document.querySelector('input[name="cipher"]:checked').value;
            const rotControl = document.getElementById('rot-control');
            // NEW VigenÃ¨re control element
            const vigenereControl = document.getElementById('vigenere-control');

            rotControl.classList.toggle('hidden', selectedCipher !== 'rot');
            vigenereControl.classList.toggle('hidden', selectedCipher !== 'vigenere');
        }

        async function performCrypto(mode) {
            const input = document.getElementById('crypto-input').value;
            const outputEl = document.getElementById('crypto-output');
            const selectedCipher = document.querySelector('input[name="cipher"]:checked').value;
            
            outputEl.value = '';

            if (selectedCipher === 'rot') {
                const shift = parseInt(document.getElementById('rot-shift').value, 10) || 13;
                outputEl.value = rotCipher(input, shift, mode === 'encrypt');
            } else if (selectedCipher === 'base64') {
                if (mode === 'encrypt') {
                    outputEl.value = base64Encode(input);
                } else {
                    outputEl.value = base64Decode(input);
                }
            } else if (selectedCipher === 'vigenere') {
                const keyword = document.getElementById('vigenere-key-input').value;
                if (!keyword.trim()) {
                    outputEl.value = "Error: Please enter a VigenÃ¨re keyword.";
                    return;
                }
                outputEl.value = vigenereCipher(input, keyword, mode);
            }
        }


        // --- Tab 2: Gemini Password Generator Logic ---

        async function generatePassword() {
            const userPrompt = document.getElementById('password-prompt').value.trim();
            const outputEl = document.getElementById('password-output');
            const generateBtn = document.getElementById('generate-btn');
            const loadingEl = document.getElementById('password-loading');
            
            if (!userPrompt) {
                outputEl.value = "Please enter a phrase or password idea for the AI to transform.";
                return;
            }

            // UI State: Loading
            generateBtn.disabled = true;
            generateBtn.textContent = 'Generating...';
            loadingEl.classList.remove('hidden');
            outputEl.value = '';
            document.getElementById('copy-message').classList.add('hidden');

            const systemPrompt = "You are a specialized security AI that helps users transform a simple or insecure password into a strong, easy-to-remember passphrase. Take the user's input (which might be an old password or a memory trigger) and create a new, long, complex, and secure password (at least 15 characters) that subtly incorporates elements of the original input, using common substitutions like 'a'->'@', 'o'->'0', 's'->'$'/'5', and adding random capitalization and digits. DO NOT explain your reasoning; just output the final password/passphrase and nothing else.";

            const payload = {
                contents: [{ parts: [{ text: `Transform this phrase/password idea into a secure passphrase: "${userPrompt}"` }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            let responseText = "Failed to generate password. Please check your connection or API configuration.";
            let maxRetries = 3;
            let delay = 1000;

            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        const result = await response.json();
                        responseText = result.candidates?.[0]?.content?.parts?.[0]?.text?.trim() || "Generation failed: Empty response.";
                        break; // Success
                    } else if (response.status === 429) {
                        console.warn(`Rate limit hit. Retrying in ${delay / 1000}s...`);
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2; // Exponential backoff
                    } else {
                        throw new Error(`API Error: ${response.status} ${response.statusText}`);
                    }
                } catch (error) {
                    responseText = `An unexpected error occurred: ${error.message}`;
                    console.error("Gemini API call failed:", error);
                    break;
                }
            }

            // UI State: Complete
            outputEl.value = responseText;
            generateBtn.disabled = false;
            generateBtn.textContent = 'Generate Secure Password';
            loadingEl.classList.add('hidden');
        }

        // --- Utility Functions ---

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            element.select();
            element.setSelectionRange(0, 99999); // For mobile devices

            // Use execCommand for broader support in iframe environments
            try {
                document.execCommand('copy');
                const msg = document.getElementById('copy-message');
                msg.classList.remove('hidden');
                setTimeout(() => msg.classList.add('hidden'), 2000);
            } catch (err) {
                console.error('Copy failed:', err);
                // Fallback for environments where execCommand is blocked
                element.value = 'Copy failed. Please manually copy the text.';
            }
        }
        
    </script>
</body>
</html>